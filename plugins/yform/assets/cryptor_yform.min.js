var CRYPTOR_YFORM=function(){var f={export_decrypted:{en:"export decrypted",de:"entschl\u00fcsselt exportieren"}},g=function(){$("#cryptor-tools-plaintext").change(function(){d({cryptor_yform:"backend_encrypt",cryptor_yform_value:$(this).val()},function(a){$("#cryptor-tools-encrypt-result").val(a)})});$("#cryptor-tools-encryptedtext").change(function(){d({cryptor_yform:"backend_decrypt",cryptor_yform_value:$(this).val()},function(a){$("#cryptor-tools-decrypt-result").val(a)})})},p=function(){var a=
h();a&&d({cryptor_yform:"field_names",cryptor_yform_value:a},function(c){if(c.length){var b=$("#rex-page-yform-manager-data-edit #rex-yform > form");$.each(c,function(){$('#rex-page-yform-manager-data-edit .table td[data-title="'+this.label+'"]').each(function(){k($(this))});"edit"===b.find('input[name="func"]').val()&&$("#rex-page-yform-manager-data-edit #yform-data_edit-"+a+"-"+this.name).each(function(){l($(this))})});m();n(b)}})},m=function(){$(".panel-heading.rex-has-panel-options .btn-default").each(function(){if(-1!==
this.href.indexOf("func=dataset_export")){var a=$(this).clone().text(f.export_decrypted[$("html").attr("lang")]).attr("href",this.href+"&cryptor_yform=dataset_export");$(this).after(a)}})},n=function(a){a.on({submit:function(c){c.preventDefault();var b=[],e=$("#rex-page-yform-manager-data-edit .cryptor-yform-element").not(".is-encrypted");e.each(function(){b.push($(this).find(".form-control").val())});b.length||a.off().submit();d({cryptor_yform:"backend_encrypt",cryptor_yform_value:b},function(c){$.each(c,
function(a){e.eq(a).find(".form-control").val(this)});a.off().submit()})}})},k=function(a){var c=q(a);if(c.text()){var b=$('<span class="fa cryptor-yform-decrypt-icon"></span>').click(function(b){b.preventDefault();b={cryptor_yform:a.hasClass("is-encrypted")?"backend_decrypt":"backend_encrypt",cryptor_yform_value:c.attr("title")};d(b,function(b){c.attr("title",b);c.text(b);a.toggleClass("is-encrypted")})});a.addClass("cryptor-yform-element is-encrypted");c.before(b)}},l=function(a){var c=r(a);if(c){var b=
$('<span class="fa cryptor-yform-decrypt-icon"></span>').click(function(b){b.preventDefault();b={cryptor_yform:a.hasClass("is-encrypted")?"backend_decrypt":"backend_encrypt",cryptor_yform_value:c.val()};d(b,function(b){a.toggleClass("is-encrypted");c.val(b)})});a.addClass("cryptor-yform-element is-encrypted");b.appendTo(a.find(".control-label"))}},d=function(a,c){$.ajax({dataType:"json",url:"../redaxo/",method:"POST",data:a,success:function(a){c(a)}})},h=function(){var a=$('form.rex-yform input[name="table_name"]').val();
if(!a)a:{a=$(".rex-page-section form:first").attr("action").split("&");for(var c=0;c<a.length;c++){var b=a[c].split("=");if("table_name"===b[0]){a=b[1];break a}}a=null}return a},r=function(a){a=a.find(".form-control");return"text"===a.prop("type")?a:"email"===a.prop("type")?(a.prop("type","text"),a):"textarea"===a.prop("tagName").toLowerCase()?a:null},q=function(a){var c=a.find("span");if(!c.length){var b=a.html();a.wrapInner("<span></span>");c=a.find("span");c.attr("title",b)}return c.addClass("cryptor-yform-list-value-wrapper")};
return{init:function(){g();p()}}}();$(document).ready(function(){CRYPTOR_YFORM.init()});